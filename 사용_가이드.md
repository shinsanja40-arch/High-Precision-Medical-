# ì˜ë£Œ ì§„ë‹¨ ì‹œìŠ¤í…œ - ì™„ì „í•œ ì‚¬ìš© ê°€ì´ë“œ

## ğŸ¯ ê°œìš”

ì´ ì‹œìŠ¤í…œì€ ì—¬ëŸ¬ AI ëª¨ë¸(Claude, GPT, Gemini, Grok)ì„ í™œìš©í•˜ì—¬ ì˜ë£Œ ì§„ë‹¨ì˜ ì •í™•ë„ë¥¼ ë†’ì´ëŠ” ì—°êµ¬ìš© í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.

**ì£¼ìš” íŠ¹ì§•**:
- ğŸ¤– ë‹¤ì¤‘ AI í˜‘ì—… ì§„ë‹¨
- âš–ï¸ ì´ì¤‘ ì‹¬íŒ ì‹œìŠ¤í…œ
- ğŸ”„ ë°˜ë³µ ê°ì§€ ë° ì°¨ë‹¨
- ğŸŒ ì›¹ ê²€ìƒ‰ í†µí•©
- ğŸ§  ë©”ëª¨ë¦¬ ê´€ë¦¬ ìµœì í™”

---

## ğŸ“¦ ì„¤ì¹˜ ë°©ë²•

### 1ë‹¨ê³„: Python í™˜ê²½ í™•ì¸
```bash
# Python 3.8 ì´ìƒ í•„ìš”
python --version
```

### 2ë‹¨ê³„: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
```bash
pip install -r requirements.txt
```

**í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬**:
- `anthropic>=0.25.0` - Claude API
- `openai>=1.0.0` - GPT API
- `google-generativeai>=0.3.0` - Gemini API
- `python-dotenv>=1.0.0` - í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
- `requests>=2.31.0` - ì›¹ ê²€ìƒ‰

---

## ğŸ”‘ API í‚¤ ì„¤ì •

### ë°©ë²• 1: .env íŒŒì¼ ìƒì„± (ê¶Œì¥)

í”„ë¡œì íŠ¸ í´ë”ì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”:

```bash
# .env íŒŒì¼ ë‚´ìš©
OPENAI_API_KEY=sk-proj-ì‹¤ì œí‚¤ì…ë ¥
ANTHROPIC_API_KEY=sk-ant-ì‹¤ì œí‚¤ì…ë ¥
GOOGLE_API_KEY=ì‹¤ì œí‚¤ì…ë ¥
XAI_API_KEY=ì‹¤ì œí‚¤ì…ë ¥  # Grok (ì„ íƒì‚¬í•­)
```

### ë°©ë²• 2: í™˜ê²½ ë³€ìˆ˜ ì§ì ‘ ì„¤ì •

```bash
export OPENAI_API_KEY=your_key
export ANTHROPIC_API_KEY=your_key
export GOOGLE_API_KEY=your_key
```

### API í‚¤ ë°œê¸‰ ë°©ë²•

| AI Provider | ë°œê¸‰ URL | ë¹„ìš© |
|------------|----------|------|
| OpenAI (GPT) | https://platform.openai.com/api-keys | ìœ ë£Œ |
| Anthropic (Claude) | https://console.anthropic.com/ | ìœ ë£Œ |
| Google (Gemini) | https://makersuite.google.com/app/apikey | ë¬´ë£Œ/ìœ ë£Œ |
| xAI (Grok) | https://console.x.ai/ | ìœ ë£Œ |

**ìµœì†Œ 1ê°œ ì´ìƒì˜ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤!**

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### ê¸°ë³¸ ì‹¤í–‰

```bash
# í•œêµ­ì–´ ëª¨ë“œ (ëŒ€í™”í˜•)
python cli.py --language ko

# ì˜ì–´ ëª¨ë“œ
python cli.py --language en
```

### ê³ ê¸‰ ì˜µì…˜

```bash
# ì—¬ëŸ¬ AI ë™ì‹œ ì‚¬ìš©
python cli.py --multi-ai

# ìƒì„¸ í† ë¡  ê³¼ì • í‘œì‹œ
python cli.py --verbose

# íŠ¹ì • AIë§Œ ì‚¬ìš©
python cli.py --provider gpt       # GPTë§Œ
python cli.py --provider claude    # Claudeë§Œ
python cli.py --provider gemini    # Geminië§Œ

# ì¡°í•© ì‚¬ìš©
python cli.py --language ko --multi-ai --verbose
```

---

## ğŸ’¬ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ê¸°ë³¸ ì§„ë‹¨

```bash
$ python cli.py --language ko

Medical Diagnosis System - Interactive Mode
============================================================

System: í™˜ìë¶„ì˜ ë‚˜ì´ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.
You: 45

System: ì„±ë³„ì„ ì•Œë ¤ì£¼ì„¸ìš” (ë‚¨ì„±/ì—¬ì„±).
You: ë‚¨ì„±

System: í˜„ì¬ ê²ªê³  ê³„ì‹  ì¦ìƒì„ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”.
You: 3ì¼ ì „ë¶€í„° ê³ ì—´ê³¼ ê¸°ì¹¨ì´ ìˆê³ , í˜¸í¡ì´ ê°€ì©ë‹ˆë‹¤.

System: í˜„ì¬ ë³µìš© ì¤‘ì¸ ì•½ë¬¼ì´ ìˆë‚˜ìš”?
You: ê³ í˜ˆì•• ì•½ (ì•„ëª¨ë””í•€)

System: ê°€ì¡±ë ¥ì´ ìˆë‚˜ìš”?
You: ë¶€ì¹œì´ ë‹¹ë‡¨ë³‘

Starting Multi-Specialist Debate
============================================================

Round 1
================================================================================

âš–ï¸ Active referee: Referee A

ğŸ“ STAGE 1: OPINION

[Dr. Alice (GPT-4)]
  ğŸ” Search: pneumonia symptoms fever cough dyspnea
ì´ í™˜ìëŠ” íë ´ì˜ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤...

[Dr. Bob (Claude)]
  ğŸ” Search: covid-19 symptoms differential diagnosis
ì½”ë¡œë‚˜19ë„ ë°°ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤...

âš–ï¸ STAGE 2: REFEREE CHECK
[Referee A]
  ğŸ” Search: pneumonia vs covid differential diagnosis
ë‘ ì§„ë‹¨ ëª¨ë‘ íƒ€ë‹¹í•˜ë‚˜, ì¶”ê°€ ê²€ì‚¬ê°€ í•„ìš”í•©ë‹ˆë‹¤...

...

FINAL DIAGNOSIS
============================================================
Most Likely: Pneumonia (75% confidence)
Alternative: COVID-19 (20% confidence)
Recommended Tests: Chest X-ray, PCR test, Blood culture
```

### ì˜ˆì‹œ 2: ë°˜ë³µ ê°ì§€ ì‘ë™

```
Round 3
================================================================================

[Dr. Alice (GPT-4)]
lupus, antibody syndrome, positive ANA test...

  âš ï¸ REPETITION DETECTED: 87% similar to round 1
  â†’ ì‹¬íŒì´ ì¸ì§€í•˜ê³  ëŒ€ì‘í•©ë‹ˆë‹¤!

[Referee B]
Dr. Aliceì˜ ì£¼ì¥ì´ ë°˜ë³µë˜ê³  ìˆìŠµë‹ˆë‹¤. 
ìƒˆë¡œìš´ ì¦ê±°ë‚˜ ë‹¤ë¥¸ ì ‘ê·¼ë²•ì´ í•„ìš”í•©ë‹ˆë‹¤...
```

---

## ğŸ” ì‹œìŠ¤í…œ ì‘ë™ ì›ë¦¬

### 1. ì´ì¤‘ ì‹¬íŒ ì‹œìŠ¤í…œ

```
Referee A: ë¼ìš´ë“œ 5, 10, 15, 20... ì— ë¦¬ì…‹
Referee B: ë¼ìš´ë“œ 2, 7, 12, 17... ì— ë¦¬ì…‹

â†’ ë‘ ì¼ì •ì´ ê²¹ì¹˜ì§€ ì•Šì•„ ë…ë¦½ì  ê°ì‹œ ê°€ëŠ¥
â†’ ë§¤ ë¼ìš´ë“œë§ˆë‹¤ í•œ ëª…ì˜ ì‹¬íŒì´ ê°œì…
```

### 2. ë°˜ë³µ ê°ì§€ (Jaccard Similarity)

```python
# ì˜ì‚¬ ë°œì–¸ í›„ ìë™ ì²´í¬
is_repetitive, similarity, round = detector.check_repetition(opinion)

# 85% ì´ìƒ ìœ ì‚¬í•˜ë©´ ê²½ê³ 
if similarity >= 0.85:
    print("âš ï¸ REPETITION DETECTED")
    # ì‹¬íŒì—ê²Œ alert ì „ë‹¬
```

### 3. ë©”ëª¨ë¦¬ ê´€ë¦¬

```
ì‹¬íŒ ë©”ëª¨ë¦¬: ìµœê·¼ 5ê°œ ë¼ìš´ë“œë§Œ ìœ ì§€ (FIFO)
ê¸´ í…ìŠ¤íŠ¸: ìë™ ìš”ì•½ (500ì ì œí•œ)
â†’ Context window ì´ˆê³¼ ë°©ì§€
```

### 4. ì›¹ ê²€ìƒ‰

```
ì—”ì§„: Bing â†’ DuckDuckGo â†’ Yahoo
ì¬ì‹œë„: ê° ì—”ì§„ë‹¹ 3íšŒ
Backoff: 2, 4, 8ì´ˆ
Rate limit: ìë™ ì¬ì‹œë„
â†’ ì„±ê³µë¥  95%+
```

---

## ğŸ“Š ì¶œë ¥ íŒŒì¼

ì§„ë‹¨ ì™„ë£Œ í›„ `diagnosis_result.json` íŒŒì¼ì´ ìƒì„±ë©ë‹ˆë‹¤:

```json
{
  "final_diagnosis": "Pneumonia",
  "confidence": 0.75,
  "differential_diagnoses": [
    {"disease": "COVID-19", "confidence": 0.20},
    {"disease": "Bronchitis", "confidence": 0.05}
  ],
  "recommended_tests": [
    "Chest X-ray",
    "PCR test",
    "Blood culture"
  ],
  "debate_rounds": 5,
  "total_searches": 12
}
```

---

## âš™ï¸ ì„¤ì • íŠœë‹

### RepetitionDetector ì„¤ì •

```python
# multi_ai_medical_diagnosis.py Line 884
self.repetition_detector = RepetitionDetector(
    max_history=10,           # ê³¼ê±° ëª‡ ë¼ìš´ë“œ ê¸°ì–µ? (ê¶Œì¥: 10-15)
    similarity_threshold=0.85 # ëª‡ % ìœ ì‚¬í•˜ë©´ ë°˜ë³µ? (ê¶Œì¥: 0.80-0.90)
)
```

### Referee ë©”ëª¨ë¦¬ ì„¤ì •

```python
# Line 883
self.max_referee_memory = 5  # ê¶Œì¥: 5-8
```

---

## ğŸ› ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: "API key not found"

**ì›ì¸**: API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
1. `.env` íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸
2. API í‚¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸
3. í™˜ê²½ ë³€ìˆ˜ê°€ ì œëŒ€ë¡œ ë¡œë“œë˜ëŠ”ì§€ í™•ì¸

```bash
# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
python -c "import os; print(os.getenv('OPENAI_API_KEY'))"
```

### ë¬¸ì œ 2: "ImportError: No module named 'anthropic'"

**ì›ì¸**: ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
```bash
pip install -r requirements.txt
```

### ë¬¸ì œ 3: "Web search failed"

**ì›ì¸**: ë„¤íŠ¸ì›Œí¬ ë¬¸ì œ ë˜ëŠ” requests ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ìŒ

**í•´ê²°**:
```bash
pip install requests
# ë˜ëŠ” ì¸í„°ë„· ì—°ê²° í™•ì¸
```

### ë¬¸ì œ 4: "Rate limit exceeded"

**ì›ì¸**: API í˜¸ì¶œ í•œë„ ì´ˆê³¼

**í•´ê²°**:
- ì ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„
- API ì‚¬ìš©ëŸ‰ í™•ì¸
- ë‹¤ë¥¸ AI í”„ë¡œë°”ì´ë” ì‚¬ìš©

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### ë²•ì  ê³ ì§€

```
âš ï¸ ì¤‘ìš”: ì´ ì‹œìŠ¤í…œì€ ì—°êµ¬ ë° êµìœ¡ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
ì‹¤ì œ ì˜ë£Œ ì§„ë‹¨ì„ ëŒ€ì²´í•  ìˆ˜ ì—†ìœ¼ë©°, ì „ë¬¸ì˜ì™€ ìƒë‹´í•´ì•¼ í•©ë‹ˆë‹¤.
```

### ë°ì´í„° í”„ë¼ì´ë²„ì‹œ

- í™˜ì ì •ë³´ëŠ” ë¡œì»¬ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤
- API í˜¸ì¶œ ì‹œ ì•”í˜¸í™”ëœ ì—°ê²° ì‚¬ìš©
- ì§„ë‹¨ ê²°ê³¼ëŠ” `diagnosis_result.json`ì— ì €ì¥
- ë¯¼ê°í•œ ì •ë³´ëŠ” ë³„ë„ ê´€ë¦¬ í•„ìš”

### ë¹„ìš© ê´€ë¦¬

| í”„ë¡œë°”ì´ë” | í‰ê·  ë¹„ìš©/ì§„ë‹¨ | ë¹„ê³  |
|-----------|--------------|------|
| GPT-4 | $0.10 - $0.30 | í† í° ì‚¬ìš©ëŸ‰ì— ë”°ë¼ |
| Claude | $0.08 - $0.25 | í† í° ì‚¬ìš©ëŸ‰ì— ë”°ë¼ |
| Gemini | ë¬´ë£Œ (ì œí•œì ) | Pro ë²„ì „ì€ ìœ ë£Œ |

**ê¶Œì¥**: í…ŒìŠ¤íŠ¸ ì‹œì—ëŠ” ë‹¨ì¼ AI ì‚¬ìš©, ì‹¤ì œ ì‚¬ìš© ì‹œ ë‹¤ì¤‘ AI í™œìš©

---

## ğŸ”¬ ê³ ê¸‰ ì‚¬ìš©ë²•

### ë°°ì¹˜ ëª¨ë“œ (JSON ì„¤ì • íŒŒì¼)

`patient_config.json` ìƒì„±:
```json
{
  "patient": {
    "age": 45,
    "gender": "male",
    "symptoms": "fever, cough, dyspnea for 3 days",
    "chronic_diseases": "hypertension",
    "medications": "amlodipine",
    "family_history": "father with diabetes"
  },
  "output_file": "diagnosis_result.json"
}
```

ì‹¤í–‰:
```bash
python cli.py --config patient_config.json
```

### í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì‚¬ìš©

```python
from multi_ai_medical_diagnosis import MultiAIDiagnosisSystem

# ì‹œìŠ¤í…œ ì´ˆê¸°í™”
system = MultiAIDiagnosisSystem(
    api_keys={
        'openai': 'your_key',
        'claude': 'your_key'
    },
    language='ko'
)

# ì§„ë‹¨ ì‹œì‘
system.start_diagnosis()

# í™˜ì ì •ë³´ ì…ë ¥
responses = ["45", "ë‚¨ì„±", "ê³ ì—´, ê¸°ì¹¨, í˜¸í¡ê³¤ë€", "ê³ í˜ˆì••", "ì•„ëª¨ë””í•€", "ì—†ìŒ"]
for resp in responses:
    system.process_patient_response(resp)

# í† ë¡  ì‹¤í–‰
result = system.run_debate()
print(result)
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Claude API ë¬¸ì„œ](https://docs.anthropic.com/)
- [OpenAI API ë¬¸ì„œ](https://platform.openai.com/docs/)
- [Gemini API ë¬¸ì„œ](https://ai.google.dev/docs/)
- [í”„ë¡œì íŠ¸ GitHub](https://github.com/[your-repo])

---

## ğŸ’¡ íŒê³¼ ìµœì í™”

### ì„±ëŠ¥ ìµœì í™”

1. **ë‹¨ì¼ AI ì‚¬ìš©**: ë¹ ë¥¸ í…ŒìŠ¤íŠ¸ìš©
   ```bash
   python cli.py --provider gpt
   ```

2. **ë‹¤ì¤‘ AI ì‚¬ìš©**: ì •í™•ë„ ì¤‘ì‹œ
   ```bash
   python cli.py --multi-ai
   ```

3. **ë©”ëª¨ë¦¬ ì„¤ì • ì¡°ì •**: ê¸´ í† ë¡  ì‹œ
   ```python
   self.max_referee_memory = 8  # 5 â†’ 8
   ```

### ì§„ë‹¨ í’ˆì§ˆ í–¥ìƒ

1. ìƒì„¸í•œ ì¦ìƒ ì„¤ëª…
2. ë³µìš© ì¤‘ì¸ ëª¨ë“  ì•½ë¬¼ ëª…ì‹œ
3. ê°€ì¡±ë ¥ ìƒì„¸íˆ ê¸°ìˆ 
4. ê²€ì‚¬ ê²°ê³¼ ì²¨ë¶€ (ê°€ëŠ¥í•œ ê²½ìš°)

---

## ğŸ†˜ ì§€ì› ë° ë¬¸ì˜

- **ì´ìŠˆ ë¦¬í¬íŠ¸**: GitHub Issues
- **ê¸°ëŠ¥ ì œì•ˆ**: GitHub Discussions
- **ê¸´ê¸‰ ë¬¸ì˜**: [ì´ë©”ì¼]

---

**ì¦ê±°ìš´ ì—°êµ¬ ë˜ì„¸ìš”!** ğŸ“
